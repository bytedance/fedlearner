{
    "comment": null,
    "config": {
        "group_alias": "sys_preset_psi_data_join",
        "job_definitions": [
            {
                "dependencies": [],
                "easy_mode": true,
                "is_federated": false,
                "job_type": "RAW_DATA",
                "name": "raw-data-job",
                "variables": [
                    {
                        "access_mode": "PEER_READABLE",
                        "name": "dataset",
                        "tag": "",
                        "typed_value": "",
                        "value": "",
                        "value_type": "STRING",
                        "widget_schema": "{\"component\":\"DatasetPath\",\"required\":true,\"hidden\":true}"
                    },
                    {
                        "access_mode": "PEER_WRITABLE",
                        "name": "raw_worker_cpu",
                        "tag": "",
                        "typed_value": "4000m",
                        "value": "4000m",
                        "value_type": "STRING",
                        "widget_schema": "{\"component\":\"Input\",\"required\":true}"
                    },
                    {
                        "access_mode": "PEER_WRITABLE",
                        "name": "raw_worker_mem",
                        "tag": "",
                        "typed_value": "8Gi",
                        "value": "8Gi",
                        "value_type": "STRING",
                        "widget_schema": "{\"component\":\"Input\",\"required\":true}"
                    },
                    {
                        "access_mode": "PEER_WRITABLE",
                        "name": "file_wildcard",
                        "tag": "",
                        "typed_value": "*part*",
                        "value": "*part*",
                        "value_type": "STRING",
                        "widget_schema": "{\"component\":\"Input\",\"required\":true,\"hidden\":true}"
                    },
                    {
                        "access_mode": "PEER_WRITABLE",
                        "name": "batch_size",
                        "tag": "",
                        "typed_value": "102400",
                        "value": "102400",
                        "value_type": "STRING",
                        "widget_schema": "{\"component\":\"Input\",\"required\":false}"
                    },
                    {
                        "access_mode": "PEER_WRITABLE",
                        "name": "data_portal_type",
                        "tag": "",
                        "typed_value": "PSI",
                        "value": "PSI",
                        "value_type": "STRING",
                        "widget_schema": "{\"component\":\"Select\",\"required\":false,\"enum\":[\"PSI\"],\"hidden\":true}"
                    },
                    {
                        "access_mode": "PEER_WRITABLE",
                        "name": "raw_master_cpu",
                        "tag": "",
                        "typed_value": "2000m",
                        "value": "2000m",
                        "value_type": "STRING",
                        "widget_schema": "{\"component\":\"Input\",\"required\":false}"
                    },
                    {
                        "access_mode": "PEER_WRITABLE",
                        "name": "raw_master_mem",
                        "tag": "",
                        "typed_value": "4Gi",
                        "value": "4Gi",
                        "value_type": "STRING",
                        "widget_schema": "{\"component\":\"Input\",\"required\":false}"
                    }
                ],
                "yaml_template": "{\n  \"apiVersion\": \"fedlearner.k8s.io/v1alpha1\",\n  \"kind\": \"FLApp\",\n  \"metadata\": {\n    \"name\": self.name,\n    \"namespace\": system.variables.namespace,\n    \"annotations\":{\n        \"queue\": \"fedlearner\",\n        \"schedulerName\": \"batch\"\n    },\n    \"labels\": dict(system.variables.labels)\n  },\n  \"spec\": {\n    \"role\": \"Follower\",\n    \"peerSpecs\": {\n      \"Leader\": {\n        \"peerURL\": \"\",\n        \"authority\": \"\"\n      }\n    },\n    \"flReplicaSpecs\": {\n      \"Master\": {\n        \"template\": {\n          \"spec\": {\n            \"restartPolicy\": \"Never\",\n            \"containers\": [\n              {\n                \"env\": system.basic_envs_list + [\n                  {\n                    \"name\": \"STORAGE_ROOT_PATH\",\n                    \"value\": str(project.variables.storage_root_path)\n                  },\n                    {\n                    \"name\": \"EGRESS_URL\",\n                    \"value\": \"fedlearner-stack-ingress-nginx-controller.default.svc:80\"\n                  },\n                  {\n                    \"name\": \"EGRESS_HOST\",\n                    \"value\": project.participants[0].egress_host\n                  },\n                  {\n                    \"name\": \"EGRESS_DOMAIN\",\n                    \"value\": project.participants[0].egress_domain\n                  },\n                  {\n                    \"name\": \"APPLICATION_ID\",\n                    \"value\": self.name\n                  },\n                  {\n                    \"name\": \"DATA_PORTAL_NAME\",\n                    \"value\": self.name\n                  },\n                    {\n                    \"name\": \"DATA_PORTAL_TYPE\",\n                    \"value\": str(self.variables.data_portal_type)\n                  },\n                  {\n                    \"name\": \"OUTPUT_PARTITION_NUM\",\n                    \"value\": str(int(workflow.variables.num_partitions))\n                  },\n                  {\n                    \"name\": \"INPUT_BASE_DIR\",\n                    \"value\": str(self.variables.dataset)\n                  },\n                  {\n                    \"name\": \"OUTPUT_BASE_DIR\",\n                    \"value\": str(project.variables.storage_root_path) + \"/raw_data/\" + self.name\n                  },\n                  {\n                    \"name\": \"RAW_DATA_PUBLISH_DIR\",\n                    \"value\": \"portal_publish_dir/\" + self.name\n                  },\n                  {\n                    \"name\": \"FILE_WILDCARD\",\n                    \"value\": str(self.variables.file_wildcard)\n                  },\n                  {\n                    \"name\": \"LONG_RUNNING\",\n                    \"value\": \"\"\n                  },\n                  {\n                    \"name\": \"CHECK_SUCCESS_TAG\",\n                    \"value\": \"\"\n                  },\n                  {\n                    \"name\": \"FILES_PER_JOB_LIMIT\",\n                    \"value\": str(None)\n                  },\n                  {\n                    \"name\": \"SINGLE_SUBFOLDER\",\n                    \"value\": \"\"\n                  },\n                  {\n                    \"name\": \"RAW_DATA_METRICS_SAMPLE_RATE\",\n                    \"value\": str(\"0\")\n                  }\n\n                ] + [],\n                \"imagePullPolicy\": \"IfNotPresent\",\n                \"name\": \"tensorflow\",\n                \"volumeMounts\": list(system.variables.volume_mounts_list),\n                \"image\": str(workflow.variables.image),\n                \"ports\": [\n                  {\n                    \"containerPort\": 50051,\n                    \"name\": \"flapp-port\",\n                    \"protocol\": \"TCP\"\n                  }\n                ],\n                \"command\": [\n                  \"/app/deploy/scripts/data_portal/run_data_portal_master.sh\"\n                ],\n                \"args\": [\n                ],\n                \"resources\": {\n                  \"limits\": {\n                    \"cpu\": str(self.variables.raw_master_cpu),\n                    \"memory\": str(self.variables.raw_master_mem)\n                  },\n                  \"requests\": {\n                    \"cpu\": str(self.variables.raw_master_cpu),\n                    \"memory\": str(self.variables.raw_master_mem)\n                  }\n                }\n              }\n            ],\n            \"imagePullSecrets\": [\n              {\n                \"name\": \"regcred\"\n              }\n            ],\n            \"volumes\": list(system.variables.volumes_list)\n          }\n        },\n        \"pair\": False,\n        \"replicas\": 1\n      },\n      \"Worker\": {\n        \"template\": {\n          \"spec\": {\n            \"restartPolicy\": \"Never\",\n            \"containers\": [\n              {\n                \"env\": system.basic_envs_list + [\n                  {\n                    \"name\": \"STORAGE_ROOT_PATH\",\n                    \"value\": str(project.variables.storage_root_path)\n                  },\n                  {\n                    \"name\": \"APPLICATION_ID\",\n                    \"value\": self.name\n                  },\n                  {\n                    \"name\": \"OUTPUT_BASE_DIR\",\n                    \"value\": str(project.variables.storage_root_path) + \"/data_source/\" + self.name\n                  },\n                  {\n                    \"name\": \"EGRESS_URL\",\n                    \"value\": \"fedlearner-stack-ingress-nginx-controller.default.svc:80\"\n                  },\n                  {\n                    \"name\": \"EGRESS_HOST\",\n                    \"value\": project.participants[0].egress_host\n                  },\n                  {\n                    \"name\": \"EGRESS_DOMAIN\",\n                    \"value\": project.participants[0].egress_domain\n                  },\n\n                  {\n                    \"name\": \"BATCH_SIZE\",\n                    \"value\": str(int(self.variables.batch_size))\n                  },\n                  {\n                    \"name\": \"INPUT_DATA_FORMAT\",\n                    \"value\": \"TF_RECORD\"\n                  },\n                  {\n                    \"name\": \"COMPRESSED_TYPE\",\n                    \"value\": \"\"\n                  },\n                  {\n                    \"name\": \"OUTPUT_DATA_FORMAT\",\n                    \"value\": \"TF_RECORD\"\n                  },\n                  {\n                    \"name\": \"BUILDER_COMPRESSED_TYPE\",\n                    \"value\": \"\"\n                  },\n                  {\n                    \"name\": \"MEMORY_LIMIT_RATIO\",\n                    \"value\": str(70)\n                  },\n                  {\n                    \"name\": \"OPTIONAL_FIELDS\",\n                    \"value\": \"\"\n                  },\n                  {\n                    \"name\": \"RAW_DATA_METRICS_SAMPLE_RATE\",\n                    \"value\": str(\"0\")\n                  }\n\n\n                ] + [],\n                \"imagePullPolicy\": \"IfNotPresent\",\n                \"name\": \"tensorflow\",\n                \"volumeMounts\": list(system.variables.volume_mounts_list),\n                \"image\": str(workflow.variables.image),\n                \"ports\": [\n                  {\n                    \"containerPort\": 50051,\n                    \"name\": \"flapp-port\",\n                    \"protocol\": \"TCP\"\n                  }\n                ],\n                \"command\": [\n                  \"/app/deploy/scripts/data_portal/run_data_portal_worker.sh\"\n                ],\n                \"args\": [\n                ],\n                \"resources\": {\n                  \"limits\": {\n                    \"cpu\": str(self.variables.raw_worker_cpu),\n                    \"memory\": str(self.variables.raw_worker_mem)\n                  },\n                  \"requests\": {\n                    \"cpu\": str(self.variables.raw_worker_cpu),\n                    \"memory\": str(self.variables.raw_worker_mem)\n                  }\n                }\n              }\n            ],\n            \"imagePullSecrets\": [\n              {\n                \"name\": \"regcred\"\n              }\n            ],\n            \"volumes\": list(system.variables.volumes_list)\n          }\n        },\n        \"pair\": False,\n        \"replicas\": int(workflow.variables.num_partitions)\n      }\n    }\n  }\n}\n"
            },
            {
                "dependencies": [
                    {
                        "source": "raw-data-job"
                    }
                ],
                "easy_mode": true,
                "is_federated": true,
                "job_type": "PSI_DATA_JOIN",
                "name": "psi-data-join-job",
                "variables": [
                    {
                        "access_mode": "PEER_WRITABLE",
                        "name": "role",
                        "tag": "",
                        "typed_value": "Leader",
                        "value": "Leader",
                        "value_type": "STRING",
                        "widget_schema": "{\"component\":\"Select\",\"required\":true,\"enum\":[\"Leader\",\"Follower\"],\"tooltip\":\"\"}"
                    },
                    {
                        "access_mode": "PEER_WRITABLE",
                        "name": "rsa_key_path",
                        "tag": "",
                        "typed_value": "/app/deploy/integrated_test/rsa_private.key",
                        "value": "/app/deploy/integrated_test/rsa_private.key",
                        "value_type": "STRING",
                        "widget_schema": "{\"component\":\"Input\",\"required\":false,\"tooltip\":\"RSA公钥或私钥的地址，在无RSA_KEY_PEM时必填，私钥需要同时填写rsa_key_path和rsa_private_key_path，且内容一致\"}"
                    },
                    {
                        "access_mode": "PEER_WRITABLE",
                        "name": "rsa_key_pem",
                        "tag": "",
                        "typed_value": "",
                        "value": "",
                        "value_type": "STRING",
                        "widget_schema": "{\"component\":\"TextArea\",\"required\":false,\"tooltip\":\"直接输入RSA公钥和私钥，Leader会从中读取私钥，Follower会从中读取公钥。如果为空会使用path读取。\"}"
                    },
                    {
                        "access_mode": "PEER_WRITABLE",
                        "name": "output_type",
                        "tag": "",
                        "typed_value": "TF_RECORD",
                        "value": "TF_RECORD",
                        "value_type": "STRING",
                        "widget_schema": "{\"component\":\"Select\",\"required\":true,\"enum\":[\"TF_RECORD\"],\"tooltip\":\"输出的datablock的格式，支持csv和tfrecord两种格式\",\"hidden\":true}"
                    },
                    {
                        "access_mode": "PEER_WRITABLE",
                        "name": "worker_cpu",
                        "tag": "",
                        "typed_value": "4000m",
                        "value": "4000m",
                        "value_type": "STRING",
                        "widget_schema": "{\"component\":\"Input\",\"required\":true}"
                    },
                    {
                        "access_mode": "PEER_WRITABLE",
                        "name": "worker_mem",
                        "tag": "",
                        "typed_value": "8Gi",
                        "value": "8Gi",
                        "value_type": "STRING",
                        "widget_schema": "{\"component\":\"Input\",\"required\":true}"
                    },
                    {
                        "access_mode": "PEER_WRITABLE",
                        "name": "master_cpu",
                        "tag": "",
                        "typed_value": "2000m",
                        "value": "2000m",
                        "value_type": "STRING",
                        "widget_schema": "{\"component\":\"Input\",\"required\":false}"
                    },
                    {
                        "access_mode": "PEER_WRITABLE",
                        "name": "master_mem",
                        "tag": "",
                        "typed_value": "4Gi",
                        "value": "4Gi",
                        "value_type": "STRING",
                        "widget_schema": "{\"component\":\"Input\",\"required\":false}"
                    }
                ],
                "yaml_template": "{\n    \"apiVersion\": \"fedlearner.k8s.io/v1alpha1\",\n    \"kind\": \"FLApp\",\n    \"metadata\": {\n    \"name\": self.name,\n    \"namespace\": system.variables.namespace,\n      \"annotations\":{\n          \"queue\": \"fedlearner\",\n          \"schedulerName\": \"batch\"\n      },\n    \"labels\": dict(system.variables.labels)\n    },\n    \"spec\": {\n        \"role\": str(self.variables.role),\n        \"cleanPodPolicy\": \"All\",\n        \"peerSpecs\": {\n        \"Leader\" if str(self.variables.role)==\"Follower\" else \"Follower\": {\n            \"peerURL\": \"fedlearner-stack-ingress-nginx-controller.default.svc:80\",\n            \"authority\": project.participants[0].egress_host,\n            \"extraHeaders\": {\n            \"x-host\": \"fedlearner-operator.\" + project.participants[0].egress_domain\n            }\n        }\n        },\n        \"flReplicaSpecs\": {\n            \"Master\": {\n                \"template\": {\n                    \"spec\": {\n                        \"restartPolicy\": \"Never\",\n                        \"containers\": [\n                            {\n                                \"env\": system.basic_envs_list + [\n                                    {\n                                        \"name\": \"STORAGE_ROOT_PATH\",\n                                        \"value\": str(project.variables.storage_root_path)\n                                    },\n                                    {\n                                        \"name\": \"ROLE\",\n                                        \"value\": str(self.variables.role).lower()\n                                    },\n                                    {\n                                        \"name\": \"APPLICATION_ID\",\n                                        \"value\": self.name\n                                    },\n                                    {\n                                        \"name\": \"OUTPUT_BASE_DIR\",\n                                        \"value\": str(project.variables.storage_root_path) + \"/data_source/\" + self.name\n                                    },\n                                    {\n                                        \"name\": \"EGRESS_URL\",\n                                        \"value\": \"fedlearner-stack-ingress-nginx-controller.default.svc:80\"\n                                    },\n                                    {\n                                        \"name\": \"EGRESS_HOST\",\n                                        \"value\": project.participants[0].egress_host\n                                    },\n                                    {\n                                        \"name\": \"EGRESS_DOMAIN\",\n                                        \"value\": project.participants[0].egress_domain\n                                    },\n                                    {\n                                        \"name\": \"PARTITION_NUM\",\n                                        \"value\": str(int(workflow.variables.num_partitions))\n                                    },\n                                    {\n                                        \"name\": \"START_TIME\",\n                                        \"value\": str(0)\n                                    },\n                                    {\n                                        \"name\": \"END_TIME\",\n                                        \"value\": str(999999999999)\n                                    },\n                                    {\n                                        \"name\": \"RAW_DATA_SUB_DIR\",\n                                        \"value\": \"portal_publish_dir/\" + str(workflow.jobs['raw-data-job'].name)\n                                    },\n                                    {\n                                        # not work, remove it after prepare_launch_data_join_cli been removed\n                                        \"name\": \"NEGATIVE_SAMPLING_RATE\",\n                                        \"value\": str(0.0)\n                                    },\n                                    {\n                                        \"name\": \"DATA_JOIN_METRICS_SAMPLE_RATE\",\n                                        \"value\": str(\"0\")\n                                    }\n                                ] + [],\n                                \"imagePullPolicy\": \"IfNotPresent\",\n                                \"name\": \"tensorflow\",\n                                \"volumeMounts\": list(system.variables.volume_mounts_list),\n                                \"image\": str(workflow.variables.image),\n                                \"ports\": [\n                                    {\n                                        \"containerPort\": 50051,\n                                        \"name\": \"flapp-port\",\n                                        \"protocol\": \"TCP\"\n                                    }\n                                ],\n                                \"command\": [\n                                    \"/app/deploy/scripts/wait4pair_wrapper.sh\"\n                                ],\n                                \"args\": [\n                                    \"/app/deploy/scripts/rsa_psi/run_psi_data_join_master.sh\"\n                                ],\n                                \"resources\": {\n                                      \"limits\": {\n                                        \"cpu\": str(self.variables.master_cpu),\n                                        \"memory\": str(self.variables.master_mem)\n                                      },\n                                      \"requests\": {\n                                        \"cpu\": str(self.variables.master_cpu),\n                                        \"memory\": str(self.variables.master_mem)\n                                      }\n                                }\n                            }\n                        ],\n                        \"imagePullSecrets\": [\n                            {\n                                \"name\": \"regcred\"\n                            }\n                        ],\n                        \"volumes\": list(system.variables.volumes_list)\n                    }\n                },\n                \"pair\": True,\n                \"replicas\": 1\n            },\n            \"Worker\": {\n                \"template\": {\n                    \"spec\": {\n                        \"restartPolicy\": \"Never\",\n                        \"containers\": [\n                            {\n                                \"env\": system.basic_envs_list + [\n                                    {\n                                        \"name\": \"STORAGE_ROOT_PATH\",\n                                        \"value\": str(project.variables.storage_root_path)\n                                    },\n                                    {\n                                        \"name\": \"EGRESS_URL\",\n                                        \"value\": \"fedlearner-stack-ingress-nginx-controller.default.svc:80\"\n                                    },\n                                    {\n                                        \"name\": \"EGRESS_HOST\",\n                                        \"value\": project.participants[0].egress_host\n                                    },\n                                    {\n                                        \"name\": \"EGRESS_DOMAIN\",\n                                        \"value\": project.participants[0].egress_domain\n                                    },\n                                    {\n                                        \"name\": \"ROLE\",\n                                        \"value\": str(self.variables.role).lower()\n                                    },\n                                    {\n                                        \"name\": \"APPLICATION_ID\",\n                                        \"value\": self.name\n                                    },\n                                    {\n                                        \"name\": \"BATCH_MODE\",\n                                        \"value\": \"--batch_mode\"\n                                    },\n                                    {\n                                        \"name\": \"OUTPUT_BASE_DIR\",\n                                        \"value\": str(project.variables.storage_root_path) + \"/data_source/\" + self.name\n                                    },\n                                    {\n                                        \"name\": \"PARTITION_NUM\",\n                                        \"value\": str(int(workflow.variables.num_partitions))\n                                    },\n                                    {\n                                        \"name\": \"RAW_DATA_SUB_DIR\",\n                                        \"value\": \"portal_publish_dir/\" + str(workflow.jobs['raw-data-job'].name)\n                                    },\n                                    {\n                                        \"name\": \"RSA_KEY_PEM\",\n                                        \"value\": str(self.variables.rsa_key_pem)\n                                    },\n                                    {\n                                        \"name\": \"RSA_KEY_PATH\",\n                                        \"value\": str(self.variables.rsa_key_path)\n                                    },\n                                    {\n                                        \"name\": \"RSA_PRIVATE_KEY_PATH\",\n                                        \"value\": str(self.variables.rsa_key_path)\n                                    },\n                                    {\n                                        \"name\": \"KMS_KEY_NAME\",\n                                        \"value\": \"\"\n                                    },\n                                    {\n                                        \"name\": \"KMS_CLIENT\",\n                                        \"value\": \"data.aml.fl\"\n                                    },\n                                    {\n                                        \"name\": \"PSI_RAW_DATA_ITER\",\n                                        \"value\": \"TF_RECORD\"\n                                    },\n                                    {\n                                        \"name\": \"DATA_BLOCK_BUILDER\",\n                                        \"value\": str(self.variables.output_type)\n                                    },\n                                    {\n                                        \"name\": \"PSI_OUTPUT_BUILDER\",\n                                        \"value\": str(self.variables.output_type)\n                                    },\n                                    {\n                                        \"name\": \"DATA_BLOCK_DUMP_INTERVAL\",\n                                        \"value\": str(-1)\n                                    },\n                                    {\n                                        \"name\": \"DATA_BLOCK_DUMP_THRESHOLD\",\n                                        \"value\": str(4096)\n                                    },\n                                    {\n                                        \"name\": \"EXAMPLE_ID_DUMP_INTERVAL\",\n                                        \"value\": str(-1)\n                                    },\n                                    {\n                                        \"name\": \"EXAMPLE_ID_DUMP_THRESHOLD\",\n                                        \"value\": str(4096)\n                                    },\n                                    {\n                                        \"name\": \"EXAMPLE_JOINER\",\n                                        \"value\": \"SORT_RUN_JOINER\"\n                                    },\n                                    {\n                                        \"name\": \"PSI_READ_AHEAD_SIZE\",\n                                        \"value\": str(None)\n                                    },\n                                    {\n                                        \"name\": \"SORT_RUN_MERGER_READ_AHEAD_BUFFER\",\n                                        \"value\": str(None)\n                                    },\n                                    {\n                                        \"name\": \"NEGATIVE_SAMPLING_RATE\",\n                                        \"value\": str(0.0)\n                                    },\n                                    {\n                                        \"name\": \"ENABLE_NEGATIVE_EXAMPLE_GENERATOR\",\n                                        \"value\": str(False)\n                                    },\n                                    {\n                                        \"name\": \"DATA_JOIN_METRICS_SAMPLE_RATE\",\n                                        \"value\": str(\"0\")\n                                    }\n                                ] + [],\n                                \"imagePullPolicy\": \"IfNotPresent\",\n                                \"name\": \"tensorflow\",\n                                \"volumeMounts\": list(system.variables.volume_mounts_list),\n                                \"image\": str(workflow.variables.image),\n                                \"ports\": [\n                                    {\n                                        \"containerPort\": 50051,\n                                        \"name\": \"flapp-port\",\n                                        \"protocol\": \"TCP\"\n                                    }\n                                ],\n                                \"command\": [\n                                    \"/app/deploy/scripts/wait4pair_wrapper.sh\"\n                                ],\n                                \"args\": [\n                                    \"/app/deploy/scripts/rsa_psi/run_psi_data_join_worker.sh\"\n                                ],\n                                \"resources\": {\n                                    \"limits\": {\n                                        \"cpu\": str(self.variables.worker_cpu),\n                                        \"memory\": str(self.variables.worker_mem)\n                                    },\n                                    \"requests\": {\n                                        \"cpu\": str(self.variables.worker_cpu),\n                                        \"memory\": str(self.variables.worker_mem)\n                                    }\n                                }\n                            }\n                        ],\n                        \"imagePullSecrets\": [\n                            {\n                                \"name\": \"regcred\"\n                            }\n                        ],\n                        \"volumes\": list(system.variables.volumes_list)\n                    }\n                },\n                \"pair\": True,\n                \"replicas\": int(int(workflow.variables.num_partitions))\n            }\n        }\n    }\n}\n"
            }
        ],
        "variables": [
            {
                "access_mode": "PEER_READABLE",
                "name": "image",
                "tag": "",
                "typed_value": "artifact.bytedance.com/fedlearner/fedlearner:50a6945",
                "value": "artifact.bytedance.com/fedlearner/fedlearner:50a6945",
                "value_type": "STRING",
                "widget_schema": "{\"component\":\"Input\",\"required\":true,\"tooltip\":\"镜像版本不建议修改，如若修改请使用新于此版本的镜像\"}"
            },
            {
                "access_mode": "PEER_WRITABLE",
                "name": "num_partitions",
                "tag": "",
                "typed_value": 2.0,
                "value": "2",
                "value_type": "NUMBER",
                "widget_schema": "{\"component\":\"NumberPicker\",\"required\":true}"
            }
        ]
    },
    "editor_info": {
        "yaml_editor_infos": {
            "psi-data-join-job": {
                "meta_yaml": "{\n    \"apiVersion\": \"fedlearner.k8s.io/v1alpha1\",\n    \"kind\": \"FLApp\",\n    \"metadata\": {\n    \"name\": self.name,\n    \"namespace\": system.variables.namespace,\n      \"annotations\":{\n          \"queue\": \"fedlearner\",\n          \"schedulerName\": \"batch\"\n      },\n    \"labels\": ${Slot_labels}\n    },\n    \"spec\": {\n        \"role\": ${Slot_role},\n        \"cleanPodPolicy\": \"All\",\n        \"peerSpecs\": {\n        \"Leader\" if ${Slot_role}==\"Follower\" else \"Follower\": {\n            \"peerURL\": \"fedlearner-stack-ingress-nginx-controller.default.svc:80\",\n            \"authority\": project.participants[0].egress_host,\n            \"extraHeaders\": {\n            \"x-host\": \"fedlearner-operator.\" + project.participants[0].egress_domain\n            }\n        }\n        },\n        \"flReplicaSpecs\": {\n            \"Master\": {\n                \"template\": {\n                    \"spec\": {\n                        \"restartPolicy\": \"Never\",\n                        \"containers\": [\n                            {\n                                \"env\": system.basic_envs_list + [\n                                    {\n                                        \"name\": \"STORAGE_ROOT_PATH\",\n                                        \"value\": ${Slot_storage_root_path}\n                                    },\n                                    {\n                                        \"name\": \"ROLE\",\n                                        \"value\": ${Slot_role}.lower()\n                                    },\n                                    {\n                                        \"name\": \"APPLICATION_ID\",\n                                        \"value\": self.name\n                                    },\n                                    {\n                                        \"name\": \"OUTPUT_BASE_DIR\",\n                                        \"value\": ${Slot_storage_root_path} + \"/data_source/\" + self.name\n                                    },\n                                    {\n                                        \"name\": \"EGRESS_URL\",\n                                        \"value\": \"fedlearner-stack-ingress-nginx-controller.default.svc:80\"\n                                    },\n                                    {\n                                        \"name\": \"EGRESS_HOST\",\n                                        \"value\": project.participants[0].egress_host\n                                    },\n                                    {\n                                        \"name\": \"EGRESS_DOMAIN\",\n                                        \"value\": project.participants[0].egress_domain\n                                    },\n                                    {\n                                        \"name\": \"PARTITION_NUM\",\n                                        \"value\": str(${Slot_partition_num})\n                                    },\n                                    {\n                                        \"name\": \"START_TIME\",\n                                        \"value\": str(${Slot_start_time})\n                                    },\n                                    {\n                                        \"name\": \"END_TIME\",\n                                        \"value\": str(${Slot_end_time})\n                                    },\n                                    {\n                                        \"name\": \"RAW_DATA_SUB_DIR\",\n                                        \"value\": \"portal_publish_dir/\" + ${Slot_raw_data_name}\n                                    },\n                                    {\n                                        # not work, remove it after prepare_launch_data_join_cli been removed\n                                        \"name\": \"NEGATIVE_SAMPLING_RATE\",\n                                        \"value\": str(${Slot_negative_sampling_rate})\n                                    },\n                                    {\n                                        \"name\": \"DATA_JOIN_METRICS_SAMPLE_RATE\",\n                                        \"value\": str(${Slot_data_join_metrics_sample_rate})\n                                    }\n                                ] + ${Slot_master_envs},\n                                \"imagePullPolicy\": \"IfNotPresent\",\n                                \"name\": \"tensorflow\",\n                                \"volumeMounts\": ${Slot_volume_mounts},\n                                \"image\": ${Slot_image},\n                                \"ports\": [\n                                    {\n                                        \"containerPort\": 50051,\n                                        \"name\": \"flapp-port\",\n                                        \"protocol\": \"TCP\"\n                                    }\n                                ],\n                                \"command\": [\n                                    \"/app/deploy/scripts/wait4pair_wrapper.sh\"\n                                ],\n                                \"args\": [\n                                    \"/app/deploy/scripts/rsa_psi/run_psi_data_join_master.sh\"\n                                ],\n                                \"resources\": {\n                                      \"limits\": {\n                                        \"cpu\": ${Slot_master_cpu},\n                                        \"memory\": ${Slot_master_memory}\n                                      },\n                                      \"requests\": {\n                                        \"cpu\": ${Slot_master_cpu},\n                                        \"memory\": ${Slot_master_memory}\n                                      }\n                                }\n                            }\n                        ],\n                        \"imagePullSecrets\": [\n                            {\n                                \"name\": \"regcred\"\n                            }\n                        ],\n                        \"volumes\": ${Slot_volumes}\n                    }\n                },\n                \"pair\": True,\n                \"replicas\": 1\n            },\n            \"Worker\": {\n                \"template\": {\n                    \"spec\": {\n                        \"restartPolicy\": \"Never\",\n                        \"containers\": [\n                            {\n                                \"env\": system.basic_envs_list + [\n                                    {\n                                        \"name\": \"STORAGE_ROOT_PATH\",\n                                        \"value\": ${Slot_storage_root_path}\n                                    },\n                                    {\n                                        \"name\": \"EGRESS_URL\",\n                                        \"value\": \"fedlearner-stack-ingress-nginx-controller.default.svc:80\"\n                                    },\n                                    {\n                                        \"name\": \"EGRESS_HOST\",\n                                        \"value\": project.participants[0].egress_host\n                                    },\n                                    {\n                                        \"name\": \"EGRESS_DOMAIN\",\n                                        \"value\": project.participants[0].egress_domain\n                                    },\n                                    {\n                                        \"name\": \"ROLE\",\n                                        \"value\": ${Slot_role}.lower()\n                                    },\n                                    {\n                                        \"name\": \"APPLICATION_ID\",\n                                        \"value\": self.name\n                                    },\n                                    {\n                                        \"name\": \"BATCH_MODE\",\n                                        \"value\": ${Slot_batch_mode}\n                                    },\n                                    {\n                                        \"name\": \"OUTPUT_BASE_DIR\",\n                                        \"value\": ${Slot_storage_root_path} + \"/data_source/\" + self.name\n                                    },\n                                    {\n                                        \"name\": \"PARTITION_NUM\",\n                                        \"value\": str(${Slot_partition_num})\n                                    },\n                                    {\n                                        \"name\": \"RAW_DATA_SUB_DIR\",\n                                        \"value\": \"portal_publish_dir/\" + ${Slot_raw_data_name}\n                                    },\n                                    {\n                                        \"name\": \"RSA_KEY_PEM\",\n                                        \"value\": ${Slot_rsa_key_pem}\n                                    },\n                                    {\n                                        \"name\": \"RSA_KEY_PATH\",\n                                        \"value\": ${Slot_rsa_key_path}\n                                    },\n                                    {\n                                        \"name\": \"RSA_PRIVATE_KEY_PATH\",\n                                        \"value\": ${Slot_rsa_key_path}\n                                    },\n                                    {\n                                        \"name\": \"KMS_KEY_NAME\",\n                                        \"value\": ${Slot_kms_key_name}\n                                    },\n                                    {\n                                        \"name\": \"KMS_CLIENT\",\n                                        \"value\": ${Slot_kms_client}\n                                    },\n                                    {\n                                        \"name\": \"PSI_RAW_DATA_ITER\",\n                                        \"value\": ${Slot_psi_raw_data_iter}\n                                    },\n                                    {\n                                        \"name\": \"DATA_BLOCK_BUILDER\",\n                                        \"value\": ${Slot_data_block_builder}\n                                    },\n                                    {\n                                        \"name\": \"PSI_OUTPUT_BUILDER\",\n                                        \"value\": ${Slot_psi_output_builder}\n                                    },\n                                    {\n                                        \"name\": \"DATA_BLOCK_DUMP_INTERVAL\",\n                                        \"value\": str(${Slot_data_block_dump_interval})\n                                    },\n                                    {\n                                        \"name\": \"DATA_BLOCK_DUMP_THRESHOLD\",\n                                        \"value\": str(${Slot_data_block_dump_threshold})\n                                    },\n                                    {\n                                        \"name\": \"EXAMPLE_ID_DUMP_INTERVAL\",\n                                        \"value\": str(${Slot_example_id_dump_interval})\n                                    },\n                                    {\n                                        \"name\": \"EXAMPLE_ID_DUMP_THRESHOLD\",\n                                        \"value\": str(${Slot_example_id_dump_threshold})\n                                    },\n                                    {\n                                        \"name\": \"EXAMPLE_JOINER\",\n                                        \"value\": \"SORT_RUN_JOINER\"\n                                    },\n                                    {\n                                        \"name\": \"PSI_READ_AHEAD_SIZE\",\n                                        \"value\": str(${Slot_psi_read_ahead_size})\n                                    },\n                                    {\n                                        \"name\": \"SORT_RUN_MERGER_READ_AHEAD_BUFFER\",\n                                        \"value\": str(${Slot_run_merger_read_ahead_buffer})\n                                    },\n                                    {\n                                        \"name\": \"NEGATIVE_SAMPLING_RATE\",\n                                        \"value\": str(${Slot_negative_sampling_rate})\n                                    },\n                                    {\n                                        \"name\": \"ENABLE_NEGATIVE_EXAMPLE_GENERATOR\",\n                                        \"value\": str(${Slot_enable_negative_example_generator})\n                                    },\n                                    {\n                                        \"name\": \"DATA_JOIN_METRICS_SAMPLE_RATE\",\n                                        \"value\": str(${Slot_data_join_metrics_sample_rate})\n                                    }\n                                ] + ${Slot_worker_envs},\n                                \"imagePullPolicy\": \"IfNotPresent\",\n                                \"name\": \"tensorflow\",\n                                \"volumeMounts\": ${Slot_volume_mounts},\n                                \"image\": ${Slot_image},\n                                \"ports\": [\n                                    {\n                                        \"containerPort\": 50051,\n                                        \"name\": \"flapp-port\",\n                                        \"protocol\": \"TCP\"\n                                    }\n                                ],\n                                \"command\": [\n                                    \"/app/deploy/scripts/wait4pair_wrapper.sh\"\n                                ],\n                                \"args\": [\n                                    \"/app/deploy/scripts/rsa_psi/run_psi_data_join_worker.sh\"\n                                ],\n                                \"resources\": {\n                                    \"limits\": {\n                                        \"cpu\": ${Slot_worker_cpu},\n                                        \"memory\": ${Slot_worker_memory}\n                                    },\n                                    \"requests\": {\n                                        \"cpu\": ${Slot_worker_cpu},\n                                        \"memory\": ${Slot_worker_memory}\n                                    }\n                                }\n                            }\n                        ],\n                        \"imagePullSecrets\": [\n                            {\n                                \"name\": \"regcred\"\n                            }\n                        ],\n                        \"volumes\": ${Slot_volumes}\n                    }\n                },\n                \"pair\": True,\n                \"replicas\": int(${Slot_partition_num})\n            }\n        }\n    }\n}\n",
                "slots": {
                    "Slot_batch_mode": {
                        "default": "",
                        "default_value": "--batch_mode",
                        "help": "如果为空则为常驻求交",
                        "label": "是否为批处理模式",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_data_block_builder": {
                        "default": "",
                        "default_value": "TF_RECORD",
                        "help": "建议不修改，choices=['TF_RECORD', 'CSV_DICT']",
                        "label": "data block output数据类型",
                        "reference": "self.variables.output_type",
                        "reference_type": "SELF",
                        "value_type": "STRING"
                    },
                    "Slot_data_block_dump_interval": {
                        "default": "",
                        "default_value": -1.0,
                        "help": "建议不修改，最多每隔多少时间（实际时间，非样本时间）就dump一次data block，小于0则无此限制",
                        "label": "数据dump时间间隔",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "INT"
                    },
                    "Slot_data_block_dump_threshold": {
                        "default": "",
                        "default_value": 4096.0,
                        "help": "建议不修改，最多多少个样本就dump为一个data block，小于等于0则无此限制",
                        "label": "数据dump临界点",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "INT"
                    },
                    "Slot_data_join_metrics_sample_rate": {
                        "default": "",
                        "default_value": "0",
                        "help": "建议不修改，es metrics 取样比例",
                        "label": "metrics_sample_rate",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_enable_negative_example_generator": {
                        "default": "",
                        "default_value": false,
                        "help": "建议不修改，是否开启负采样，当follower求交时遇到无法匹配上的leader的example id，会以negative_sampling_rate为概率生成一个新的样本。",
                        "label": "负采样比例",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "BOOL"
                    },
                    "Slot_end_time": {
                        "default": "",
                        "default_value": 999999999999.0,
                        "help": "建议不修改，使用自这个时间以前的数据，仅从文件名筛选所以格式依据文件名（yyyymmdd或timestamp）",
                        "label": "数据末尾时间",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "INT"
                    },
                    "Slot_example_id_dump_interval": {
                        "default": "",
                        "default_value": -1.0,
                        "help": "建议不修改，最多每隔多少时间（实际时间，非样本时间）就dump一次example id，小于0则无此限制",
                        "label": "数据id dump时间间隔",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "INT"
                    },
                    "Slot_example_id_dump_threshold": {
                        "default": "",
                        "default_value": 4096.0,
                        "help": "建议不修改，最多每隔多少时间（实际时间，非样本时间）就dump一次example id，小于0则无此限制",
                        "label": "数据id dump临界点",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "INT"
                    },
                    "Slot_image": {
                        "default": "",
                        "default_value": "artifact.bytedance.com/fedlearner/fedlearner:50a6945",
                        "help": "建议不修改，指定Pod中运行的容器镜像地址，修改此项可能导致本基本模板不适用",
                        "label": "容器镜像",
                        "reference": "workflow.variables.image",
                        "reference_type": "WORKFLOW",
                        "value_type": "STRING"
                    },
                    "Slot_kms_client": {
                        "default": "",
                        "default_value": "data.aml.fl",
                        "help": "kms client",
                        "label": "kms client",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_kms_key_name": {
                        "default": "",
                        "default_value": "",
                        "help": "kms中的密钥名称，站内镜像需使用KMS",
                        "label": "密钥名称",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_labels": {
                        "default": "",
                        "default_value": {},
                        "help": "建议不修改，格式： {}",
                        "label": "FLAPP额外元信息",
                        "reference": "system.variables.labels",
                        "reference_type": "SYSTEM",
                        "value_type": "OBJECT"
                    },
                    "Slot_master_cpu": {
                        "default": "",
                        "default_value": "2000m",
                        "help": "Master Pod 所分配的CPU资源（request和limit一致）",
                        "label": "Master的CPU",
                        "reference": "self.variables.master_cpu",
                        "reference_type": "SELF",
                        "value_type": "STRING"
                    },
                    "Slot_master_envs": {
                        "default": "",
                        "default_value": [],
                        "help": "数组类型，master pod额外的环境变量",
                        "label": "Master额外环境变量",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "LIST"
                    },
                    "Slot_master_memory": {
                        "default": "",
                        "default_value": "3Gi",
                        "help": "Master Pod 所分配的内存资源（request和limit一致）",
                        "label": "Master的内存",
                        "reference": "self.variables.master_mem",
                        "reference_type": "SELF",
                        "value_type": "STRING"
                    },
                    "Slot_negative_sampling_rate": {
                        "default": "",
                        "default_value": 0.0,
                        "help": "建议不修改，负采样比例，当follower求交时遇到无法匹配上的leader的example id，会以此概率生成一个新的样本。",
                        "label": "负采样比例",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "NUMBER"
                    },
                    "Slot_partition_num": {
                        "default": "",
                        "default_value": 4.0,
                        "help": "建议修改，求交后数据分区的数量，建议和raw_data一致",
                        "label": "数据分区的数量",
                        "reference": "workflow.variables.num_partitions",
                        "reference_type": "WORKFLOW",
                        "value_type": "INT"
                    },
                    "Slot_psi_output_builder": {
                        "default": "",
                        "default_value": "TF_RECORD",
                        "help": "建议不修改，choices=['TF_RECORD', 'CSV_DICT']",
                        "label": "PSI output数据类型",
                        "reference": "self.variables.output_type",
                        "reference_type": "SELF",
                        "value_type": "STRING"
                    },
                    "Slot_psi_raw_data_iter": {
                        "default": "",
                        "default_value": "TF_RECORD",
                        "help": "建议不修改，choices=['TF_RECORD', 'CSV_DICT']",
                        "label": "raw data数据类型",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_psi_read_ahead_size": {
                        "default": "",
                        "default_value": null,
                        "help": "建议不填, the read ahead size for raw data",
                        "label": "psi_read_ahead_size",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "INT"
                    },
                    "Slot_raw_data_name": {
                        "default": "",
                        "default_value": "",
                        "help": "必须修改，原始数据的发布地址，根据参数内容在portal_publish_dir地址下寻找",
                        "label": "raw_data名字",
                        "reference": "workflow.jobs['raw-data-job'].name",
                        "reference_type": "JOB_PROPERTY",
                        "value_type": "STRING"
                    },
                    "Slot_role": {
                        "default": "",
                        "default_value": "Leader",
                        "help": "Flapp 通讯时的角色 Leader 或 Follower",
                        "label": "Flapp通讯时角色",
                        "reference": "self.variables.role",
                        "reference_type": "SELF",
                        "value_type": "STRING"
                    },
                    "Slot_rsa_key_path": {
                        "default": "",
                        "default_value": "",
                        "help": "RSA公钥或私钥的地址，在无RSA_KEY_PEM时必填",
                        "label": "RSA钥匙地址",
                        "reference": "self.variables.rsa_key_path",
                        "reference_type": "SELF",
                        "value_type": "STRING"
                    },
                    "Slot_rsa_key_pem": {
                        "default": "",
                        "default_value": "",
                        "help": "直接输入RSA公钥和私钥，请使用Textarea，Leader会从中读取私钥，Follower会从中读取公钥。如果为空会使用path读取。",
                        "label": "RSA公钥",
                        "reference": "self.variables.rsa_key_pem",
                        "reference_type": "SELF",
                        "value_type": "STRING"
                    },
                    "Slot_run_merger_read_ahead_buffer": {
                        "default": "",
                        "default_value": null,
                        "help": "建议不填, sort run merger read ahead buffer",
                        "label": "run_merger_read_ahead_buffer",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "INT"
                    },
                    "Slot_start_time": {
                        "default": "",
                        "default_value": 0.0,
                        "help": "建议不修改，使用自这个时间起的数据，仅从文件名筛选所以格式依据文件名（yyyymmdd或timestamp）",
                        "label": "数据起始时间",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "INT"
                    },
                    "Slot_storage_root_path": {
                        "default": "",
                        "default_value": "/data",
                        "help": "联邦学习中任务存储根目录",
                        "label": "存储根目录",
                        "reference": "project.variables.storage_root_path",
                        "reference_type": "PROJECT",
                        "value_type": "STRING"
                    },
                    "Slot_volume_mounts": {
                        "default": "",
                        "default_value": [
                            {
                                "mountPath": "/data",
                                "name": "data"
                            }
                        ],
                        "help": "建议不修改，容器中卷挂载的位置，数组类型",
                        "label": "卷挂载位置",
                        "reference": "system.variables.volume_mounts_list",
                        "reference_type": "SYSTEM",
                        "value_type": "LIST"
                    },
                    "Slot_volumes": {
                        "default": "",
                        "default_value": [
                            {
                                "name": "data",
                                "persistentVolumeClaim": {
                                    "claimName": "pvc-fedlearner-default"
                                }
                            }
                        ],
                        "help": "建议不修改，数组类型，和volume_mounts一一对应",
                        "label": "为Pod提供的卷",
                        "reference": "system.variables.volumes_list",
                        "reference_type": "SYSTEM",
                        "value_type": "LIST"
                    },
                    "Slot_worker_cpu": {
                        "default": "",
                        "default_value": "2000m",
                        "help": "Worker Pod 所分配的CPU资源（request和limit一致）",
                        "label": "Worker的CPU",
                        "reference": "self.variables.worker_cpu",
                        "reference_type": "SELF",
                        "value_type": "STRING"
                    },
                    "Slot_worker_envs": {
                        "default": "",
                        "default_value": [],
                        "help": "数组类型，worker pod额外的环境变量",
                        "label": "Worker额外环境变量",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "LIST"
                    },
                    "Slot_worker_memory": {
                        "default": "",
                        "default_value": "3Gi",
                        "help": "Worker Pod 所分配的内存资源（request和limit一致）",
                        "label": "Worker的内存",
                        "reference": "self.variables.worker_mem",
                        "reference_type": "SELF",
                        "value_type": "STRING"
                    }
                },
                "variables": []
            },
            "raw-data-job": {
                "meta_yaml": "{\n  \"apiVersion\": \"fedlearner.k8s.io/v1alpha1\",\n  \"kind\": \"FLApp\",\n  \"metadata\": {\n    \"name\": self.name,\n    \"namespace\": system.variables.namespace,\n    \"annotations\":{\n        \"queue\": \"fedlearner\",\n        \"schedulerName\": \"batch\"\n    },\n    \"labels\": ${Slot_labels}\n  },\n  \"spec\": {\n    \"role\": \"Follower\",\n    \"peerSpecs\": {\n      \"Leader\": {\n        \"peerURL\": \"\",\n        \"authority\": \"\"\n      }\n    },\n    \"flReplicaSpecs\": {\n      \"Master\": {\n        \"template\": {\n          \"spec\": {\n            \"restartPolicy\": \"Never\",\n            \"containers\": [\n              {\n                \"env\": system.basic_envs_list + [\n                  {\n                    \"name\": \"STORAGE_ROOT_PATH\",\n                    \"value\": ${Slot_storage_root_path}\n                  },\n                    {\n                    \"name\": \"EGRESS_URL\",\n                    \"value\": \"fedlearner-stack-ingress-nginx-controller.default.svc:80\"\n                  },\n                  {\n                    \"name\": \"EGRESS_HOST\",\n                    \"value\": project.participants[0].egress_host\n                  },\n                  {\n                    \"name\": \"EGRESS_DOMAIN\",\n                    \"value\": project.participants[0].egress_domain\n                  },\n                  {\n                    \"name\": \"APPLICATION_ID\",\n                    \"value\": self.name\n                  },\n                  {\n                    \"name\": \"DATA_PORTAL_NAME\",\n                    \"value\": self.name\n                  },\n                    {\n                    \"name\": \"DATA_PORTAL_TYPE\",\n                    \"value\": ${Slot_data_portal_type}\n                  },\n                  {\n                    \"name\": \"OUTPUT_PARTITION_NUM\",\n                    \"value\": str(${Slot_output_partition_num})\n                  },\n                  {\n                    \"name\": \"INPUT_BASE_DIR\",\n                    \"value\": ${Slot_input_base_dir}\n                  },\n                  {\n                    \"name\": \"OUTPUT_BASE_DIR\",\n                    \"value\": ${Slot_storage_root_path} + \"/raw_data/\" + self.name\n                  },\n                  {\n                    \"name\": \"RAW_DATA_PUBLISH_DIR\",\n                    \"value\": \"portal_publish_dir/\" + self.name\n                  },\n                  {\n                    \"name\": \"FILE_WILDCARD\",\n                    \"value\": ${Slot_file_wildcard}\n                  },\n                  {\n                    \"name\": \"LONG_RUNNING\",\n                    \"value\": ${Slot_long_running}\n                  },\n                  {\n                    \"name\": \"CHECK_SUCCESS_TAG\",\n                    \"value\": ${Slot_check_success_tag}\n                  },\n                  {\n                    \"name\": \"FILES_PER_JOB_LIMIT\",\n                    \"value\": str(${Slot_files_per_job_limit})\n                  },\n                  {\n                    \"name\": \"SINGLE_SUBFOLDER\",\n                    \"value\": ${Slot_single_subfolder}\n                  },\n                  {\n                    \"name\": \"RAW_DATA_METRICS_SAMPLE_RATE\",\n                    \"value\": str(${Slot_raw_data_metrics_sample_rate})\n                  }\n\n                ] + ${Slot_master_envs},\n                \"imagePullPolicy\": \"IfNotPresent\",\n                \"name\": \"tensorflow\",\n                \"volumeMounts\": ${Slot_volume_mounts},\n                \"image\": ${Slot_image},\n                \"ports\": [\n                  {\n                    \"containerPort\": 50051,\n                    \"name\": \"flapp-port\",\n                    \"protocol\": \"TCP\"\n                  }\n                ],\n                \"command\": [\n                  \"/app/deploy/scripts/data_portal/run_data_portal_master.sh\"\n                ],\n                \"args\": [\n                ],\n                \"resources\": {\n                  \"limits\": {\n                    \"cpu\": ${Slot_master_cpu},\n                    \"memory\": ${Slot_master_memory}\n                  },\n                  \"requests\": {\n                    \"cpu\": ${Slot_master_cpu},\n                    \"memory\": ${Slot_master_memory}\n                  }\n                }\n              }\n            ],\n            \"imagePullSecrets\": [\n              {\n                \"name\": \"regcred\"\n              }\n            ],\n            \"volumes\": ${Slot_volumes}\n          }\n        },\n        \"pair\": False,\n        \"replicas\": 1\n      },\n      \"Worker\": {\n        \"template\": {\n          \"spec\": {\n            \"restartPolicy\": \"Never\",\n            \"containers\": [\n              {\n                \"env\": system.basic_envs_list + [\n                  {\n                    \"name\": \"STORAGE_ROOT_PATH\",\n                    \"value\": ${Slot_storage_root_path}\n                  },\n                  {\n                    \"name\": \"APPLICATION_ID\",\n                    \"value\": self.name\n                  },\n                  {\n                    \"name\": \"OUTPUT_BASE_DIR\",\n                    \"value\": ${Slot_storage_root_path} + \"/data_source/\" + self.name\n                  },\n                  {\n                    \"name\": \"EGRESS_URL\",\n                    \"value\": \"fedlearner-stack-ingress-nginx-controller.default.svc:80\"\n                  },\n                  {\n                    \"name\": \"EGRESS_HOST\",\n                    \"value\": project.participants[0].egress_host\n                  },\n                  {\n                    \"name\": \"EGRESS_DOMAIN\",\n                    \"value\": project.participants[0].egress_domain\n                  },\n\n                  {\n                    \"name\": \"BATCH_SIZE\",\n                    \"value\": str(${Slot_batch_size})\n                  },\n                  {\n                    \"name\": \"INPUT_DATA_FORMAT\",\n                    \"value\": ${Slot_input_data_format}\n                  },\n                  {\n                    \"name\": \"COMPRESSED_TYPE\",\n                    \"value\": ${Slot_compressed_type}\n                  },\n                  {\n                    \"name\": \"OUTPUT_DATA_FORMAT\",\n                    \"value\": ${Slot_output_data_format}\n                  },\n                  {\n                    \"name\": \"BUILDER_COMPRESSED_TYPE\",\n                    \"value\": ${Slot_builder_compressed_type}\n                  },\n                  {\n                    \"name\": \"MEMORY_LIMIT_RATIO\",\n                    \"value\": str(${Slot_memory_limit_ratio})\n                  },\n                  {\n                    \"name\": \"OPTIONAL_FIELDS\",\n                    \"value\": ${Slot_optional_fields}\n                  },\n                  {\n                    \"name\": \"RAW_DATA_METRICS_SAMPLE_RATE\",\n                    \"value\": str(${Slot_raw_data_metrics_sample_rate})\n                  }\n\n\n                ] + ${Slot_worker_envs},\n                \"imagePullPolicy\": \"IfNotPresent\",\n                \"name\": \"tensorflow\",\n                \"volumeMounts\": ${Slot_volume_mounts},\n                \"image\": ${Slot_image},\n                \"ports\": [\n                  {\n                    \"containerPort\": 50051,\n                    \"name\": \"flapp-port\",\n                    \"protocol\": \"TCP\"\n                  }\n                ],\n                \"command\": [\n                  \"/app/deploy/scripts/data_portal/run_data_portal_worker.sh\"\n                ],\n                \"args\": [\n                ],\n                \"resources\": {\n                  \"limits\": {\n                    \"cpu\": ${Slot_worker_cpu},\n                    \"memory\": ${Slot_worker_memory}\n                  },\n                  \"requests\": {\n                    \"cpu\": ${Slot_worker_cpu},\n                    \"memory\": ${Slot_worker_memory}\n                  }\n                }\n              }\n            ],\n            \"imagePullSecrets\": [\n              {\n                \"name\": \"regcred\"\n              }\n            ],\n            \"volumes\": ${Slot_volumes}\n          }\n        },\n        \"pair\": False,\n        \"replicas\": ${Slot_output_partition_num}\n      }\n    }\n  }\n}\n",
                "slots": {
                    "Slot_batch_size": {
                        "default": "",
                        "default_value": 1024.0,
                        "help": "原始数据是一批一批的从文件系统中读出来，batch_size为batch的大小",
                        "label": "Batch大小",
                        "reference": "self.variables.batch_size",
                        "reference_type": "SELF",
                        "value_type": "INT"
                    },
                    "Slot_builder_compressed_type": {
                        "default": "",
                        "default_value": "",
                        "help": "choices=['', 'ZLIB', 'GZIP']  the format for output file",
                        "label": "输出压缩格式",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_check_success_tag": {
                        "default": "",
                        "default_value": "",
                        "help": "choices:['','--check_success_tag'] means false and true, Check that a _SUCCESS file exists before processing files in a subfolder",
                        "label": "是否检查成功标志",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_compressed_type": {
                        "default": "",
                        "default_value": "",
                        "help": "choices=['', 'ZLIB', 'GZIP']  the compressed type of input data file",
                        "label": "压缩方式",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_data_portal_type": {
                        "default": "",
                        "default_value": "PSI",
                        "help": "运行过一次后修改无效！！ the type of data portal type ,choices=['PSI', 'Streaming']",
                        "label": "数据入口类型",
                        "reference": "self.variables.data_portal_type",
                        "reference_type": "SELF",
                        "value_type": "STRING"
                    },
                    "Slot_file_wildcard": {
                        "default": "",
                        "default_value": "*.rd",
                        "help": "文件名称的通配符， 将会读取input_base_dir下所以满足条件的文件，如\n1. *.csv，意为读取所有csv格式文件\n2. *.tfrecord，意为读取所有tfrecord格式文件\n3. xxx.txt，意为读取文件名为xxx.txt的文件",
                        "label": "文件名称的通配符",
                        "reference": "self.variables.file_wildcard",
                        "reference_type": "SELF",
                        "value_type": "STRING"
                    },
                    "Slot_files_per_job_limit": {
                        "default": "",
                        "default_value": null,
                        "help": "空即不设限制，Max number of files in a job",
                        "label": "每个任务最多文件数",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "INT"
                    },
                    "Slot_image": {
                        "default": "",
                        "default_value": "artifact.bytedance.com/fedlearner/fedlearner:50a6945",
                        "help": "建议不修改，指定Pod中运行的容器镜像地址，修改此项可能导致本基本模板不适用",
                        "label": "容器镜像",
                        "reference": "workflow.variables.image",
                        "reference_type": "WORKFLOW",
                        "value_type": "STRING"
                    },
                    "Slot_input_base_dir": {
                        "default": "",
                        "default_value": "/app/deploy/integrated_test/tfrecord_raw_data",
                        "help": "必须修改，运行过一次后修改无效！！the base dir of input directory",
                        "label": "输入路径",
                        "reference": "self.variables.dataset",
                        "reference_type": "SELF",
                        "value_type": "STRING"
                    },
                    "Slot_input_data_format": {
                        "default": "",
                        "default_value": "TF_RECORD",
                        "help": "choices=['TF_RECORD', 'CSV_DICT']  the type for input data iterator",
                        "label": "输入数据格式",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_labels": {
                        "default": "",
                        "default_value": {},
                        "help": "建议不修改，格式： {}",
                        "label": "FLAPP额外元信息",
                        "reference": "system.variables.labels",
                        "reference_type": "SYSTEM",
                        "value_type": "OBJECT"
                    },
                    "Slot_long_running": {
                        "default": "",
                        "default_value": "",
                        "help": "choices: ['','--long_running']否，是。是否为常驻上传原始数据",
                        "label": "是否常驻",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_master_cpu": {
                        "default": "",
                        "default_value": "2000m",
                        "help": "Master Pod 所分配的CPU资源（request和limit一致）",
                        "label": "Master的CPU",
                        "reference": "self.variables.raw_master_cpu",
                        "reference_type": "SELF",
                        "value_type": "STRING"
                    },
                    "Slot_master_envs": {
                        "default": "",
                        "default_value": [],
                        "help": "数组类型，master pod额外的环境变量",
                        "label": "Master额外环境变量",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "LIST"
                    },
                    "Slot_master_memory": {
                        "default": "",
                        "default_value": "3Gi",
                        "help": "Master Pod 所分配的内存资源（request和limit一致）",
                        "label": "Master的内存",
                        "reference": "self.variables.raw_master_mem",
                        "reference_type": "SELF",
                        "value_type": "STRING"
                    },
                    "Slot_memory_limit_ratio": {
                        "default": "",
                        "default_value": 70.0,
                        "help": "预测是否会OOM的时候用到，如果预测继续执行下去时占用内存会超过这个比例，就阻塞，直到尚未处理的任务处理完成。 注意这是个40-81之间的整数。",
                        "label": "内存限制比例",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "INT"
                    },
                    "Slot_optional_fields": {
                        "default": "",
                        "default_value": "",
                        "help": "optional stat fields used in joiner, separated by comma between fields, e.g. \"label,rit\"Each field will be stripped",
                        "label": "可选字段",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_output_data_format": {
                        "default": "",
                        "default_value": "TF_RECORD",
                        "help": "choices=['TF_RECORD', 'CSV_DICT']  the format for output file",
                        "label": "输出格式",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_output_partition_num": {
                        "default": "",
                        "default_value": 4.0,
                        "help": "运行过一次后修改无效！！输出数据的文件数量，对应Worker数量",
                        "label": "数据分区的数量",
                        "reference": "workflow.variables.num_partitions",
                        "reference_type": "WORKFLOW",
                        "value_type": "INT"
                    },
                    "Slot_raw_data_metrics_sample_rate": {
                        "default": "",
                        "default_value": "0",
                        "help": "建议不修改，es metrics 取样比例",
                        "label": "metrics_sample_rate",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_single_subfolder": {
                        "default": "",
                        "default_value": "",
                        "help": "choices:['','--single_subfolder'] 否 是，Only process one subfolder at a time",
                        "label": "是否单一子文件夹",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_storage_root_path": {
                        "default": "",
                        "default_value": "/data",
                        "help": "联邦学习中任务存储根目录",
                        "label": "存储根目录",
                        "reference": "project.variables.storage_root_path",
                        "reference_type": "PROJECT",
                        "value_type": "STRING"
                    },
                    "Slot_volume_mounts": {
                        "default": "",
                        "default_value": [
                            {
                                "mountPath": "/data",
                                "name": "data"
                            }
                        ],
                        "help": "建议不修改，容器中卷挂载的位置，数组类型",
                        "label": "卷挂载位置",
                        "reference": "system.variables.volume_mounts_list",
                        "reference_type": "SYSTEM",
                        "value_type": "LIST"
                    },
                    "Slot_volumes": {
                        "default": "",
                        "default_value": [
                            {
                                "name": "data",
                                "persistentVolumeClaim": {
                                    "claimName": "pvc-fedlearner-default"
                                }
                            }
                        ],
                        "help": "建议不修改，数组类型，和volume_mounts一一对应",
                        "label": "为Pod提供的卷",
                        "reference": "system.variables.volumes_list",
                        "reference_type": "SYSTEM",
                        "value_type": "LIST"
                    },
                    "Slot_worker_cpu": {
                        "default": "",
                        "default_value": "2000m",
                        "help": "Worker Pod 所分配的CPU资源（request和limit一致）",
                        "label": "Worker的CPU",
                        "reference": "self.variables.raw_worker_cpu",
                        "reference_type": "SELF",
                        "value_type": "STRING"
                    },
                    "Slot_worker_envs": {
                        "default": "",
                        "default_value": [],
                        "help": "数组类型，worker pod额外的环境变量",
                        "label": "Worker额外环境变量",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "LIST"
                    },
                    "Slot_worker_memory": {
                        "default": "",
                        "default_value": "3Gi",
                        "help": "Worker Pod 所分配的内存资源（request和limit一致）",
                        "label": "Worker的内存",
                        "reference": "self.variables.raw_worker_mem",
                        "reference_type": "SELF",
                        "value_type": "STRING"
                    }
                },
                "variables": []
            }
        }
    },
    "group_alias": "sys_preset_psi_data_join",
    "name": "sys-preset-psi-data-join"
}
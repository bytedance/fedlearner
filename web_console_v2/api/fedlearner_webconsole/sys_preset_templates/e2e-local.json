{
    "comment": "",
    "config": {
        "group_alias": "e2e-test",
        "job_definitions": [
            {
                "dependencies": [],
                "easy_mode": true,
                "is_federated": false,
                "job_type": "RAW_DATA",
                "name": "raw-data-job",
                "variables": [],
                "yaml_template": "{\n  \"apiVersion\": \"fedlearner.k8s.io/v1alpha1\",\n  \"kind\": \"FLApp\",\n  \"metadata\": {\n    \"name\": self.name,\n    \"namespace\": system.variables.namespace,\n    \"annotations\":{\n        \"queue\": \"fedlearner\",\n        \"schedulerName\": \"batch\"\n    },\n    \"labels\": dict(system.variables.labels)\n  },\n  \"spec\": {\n    \"role\": \"Follower\",\n    \"peerSpecs\": {\n      \"Leader\": {\n        \"peerURL\": \"\",\n        \"authority\": \"\"\n      }\n    },\n    \"flReplicaSpecs\": {\n      \"Master\": {\n        \"template\": {\n          \"spec\": {\n            \"restartPolicy\": \"Never\",\n            \"containers\": [\n              {\n                \"env\": system.basic_envs_list + [\n                  {\n                    \"name\": \"STORAGE_ROOT_PATH\",\n                    \"value\": project.variables.storage_root_path\n                  },\n                    {\n                    \"name\": \"EGRESS_URL\",\n                    \"value\": \"fedlearner-stack-ingress-nginx-controller.default.svc:80\"\n                  },\n                  {\n                    \"name\": \"EGRESS_HOST\",\n                    \"value\": project.participants[0].egress_host\n                  },\n                  {\n                    \"name\": \"EGRESS_DOMAIN\",\n                    \"value\": project.participants[0].egress_domain\n                  },\n                  {\n                    \"name\": \"APPLICATION_ID\",\n                    \"value\": self.name\n                  },\n                  {\n                    \"name\": \"DATA_PORTAL_NAME\",\n                    \"value\": self.name\n                  },\n                    {\n                    \"name\": \"DATA_PORTAL_TYPE\",\n                    \"value\": \"Streaming\"\n                  },\n                  {\n                    \"name\": \"OUTPUT_PARTITION_NUM\",\n                    \"value\": str(4)\n                  },\n                  {\n                    \"name\": \"INPUT_BASE_DIR\",\n                    \"value\": \"/app/deploy/integrated_test/tfrecord_raw_data\"\n                  },\n                  {\n                    \"name\": \"OUTPUT_BASE_DIR\",\n                    \"value\": project.variables.storage_root_path + \"/raw_data/\" + self.name\n                  },\n                  {\n                    \"name\": \"RAW_DATA_PUBLISH_DIR\",\n                    \"value\": \"portal_publish_dir/\" + self.name\n                  },\n                  {\n                    \"name\": \"FILE_WILDCARD\",\n                    \"value\": \"*.rd\"\n                  },\n                  {\n                    \"name\": \"LONG_RUNNING\",\n                    \"value\": \"\"\n                  },\n                  {\n                    \"name\": \"CHECK_SUCCESS_TAG\",\n                    \"value\": \"--check_success_tag\"\n                  },\n                  {\n                    \"name\": \"FILES_PER_JOB_LIMIT\",\n                    \"value\": str(None)\n                  },\n                  {\n                    \"name\": \"SINGLE_SUBFOLDER\",\n                    \"value\": \"\"\n                  }\n\n                ] + [],\n                \"imagePullPolicy\": \"IfNotPresent\",\n                \"name\": \"tensorflow\",\n                \"volumeMounts\": list(system.variables.volume_mounts_list),\n                \"image\": workflow.variables.image,\n                \"ports\": [\n                  {\n                    \"containerPort\": 50051,\n                    \"name\": \"flapp-port\",\n                    \"protocol\": \"TCP\"\n                  }\n                ],\n                \"command\": [\n                  \"/app/deploy/scripts/data_portal/run_data_portal_master.sh\"\n                ],\n                \"args\": [\n                ],\n                \"resources\": {\n                  \"limits\": {\n                    \"cpu\": \"2000m\",\n                    \"memory\": \"3Gi\"\n                  },\n                  \"requests\": {\n                    \"cpu\": \"2000m\",\n                    \"memory\": \"3Gi\"\n                  }\n                }\n              }\n            ],\n            \"imagePullSecrets\": [\n              {\n                \"name\": \"regcred\"\n              }\n            ],\n            \"volumes\": list(system.variables.volumes_list)\n          }\n        },\n        \"pair\": False,\n        \"replicas\": 1\n      },\n      \"Worker\": {\n        \"template\": {\n          \"spec\": {\n            \"restartPolicy\": \"Never\",\n            \"containers\": [\n              {\n                \"env\": system.basic_envs_list + [\n                  {\n                    \"name\": \"STORAGE_ROOT_PATH\",\n                    \"value\": project.variables.storage_root_path\n                  },\n                  {\n                    \"name\": \"APPLICATION_ID\",\n                    \"value\": self.name\n                  },\n                  {\n                    \"name\": \"OUTPUT_BASE_DIR\",\n                    \"value\": project.variables.storage_root_path + \"/data_source/\" + self.name\n                  },\n                  {\n                    \"name\": \"EGRESS_URL\",\n                    \"value\": \"fedlearner-stack-ingress-nginx-controller.default.svc:80\"\n                  },\n                  {\n                    \"name\": \"EGRESS_HOST\",\n                    \"value\": project.participants[0].egress_host\n                  },\n                  {\n                    \"name\": \"EGRESS_DOMAIN\",\n                    \"value\": project.participants[0].egress_domain\n                  },\n\n                  {\n                    \"name\": \"BATCH_SIZE\",\n                    \"value\": str(1024)\n                  },\n                  {\n                    \"name\": \"INPUT_DATA_FORMAT\",\n                    \"value\": \"TF_RECORD\"\n                  },\n                  {\n                    \"name\": \"COMPRESSED_TYPE\",\n                    \"value\": \"\"\n                  },\n                  {\n                    \"name\": \"OUTPUT_DATA_FORMAT\",\n                    \"value\": \"TF_RECORD\"\n                  },\n                  {\n                    \"name\": \"BUILDER_COMPRESSED_TYPE\",\n                    \"value\": \"\"\n                  },\n                  {\n                    \"name\": \"MEMORY_LIMIT_RATIO\",\n                    \"value\": str(70)\n                  },\n                  {\n                    \"name\": \"OPTIONAL_FIELDS\",\n                    \"value\": \"\"\n                  }\n\n\n                ] + [],\n                \"imagePullPolicy\": \"IfNotPresent\",\n                \"name\": \"tensorflow\",\n                \"volumeMounts\": list(system.variables.volume_mounts_list),\n                \"image\": workflow.variables.image,\n                \"ports\": [\n                  {\n                    \"containerPort\": 50051,\n                    \"name\": \"flapp-port\",\n                    \"protocol\": \"TCP\"\n                  }\n                ],\n                \"command\": [\n                  \"/app/deploy/scripts/data_portal/run_data_portal_worker.sh\"\n                ],\n                \"args\": [\n                ],\n                \"resources\": {\n                  \"limits\": {\n                    \"cpu\": \"2000m\",\n                    \"memory\": \"3Gi\"\n                  },\n                  \"requests\": {\n                    \"cpu\": \"2000m\",\n                    \"memory\": \"3Gi\"\n                  }\n                }\n              }\n            ],\n            \"imagePullSecrets\": [\n              {\n                \"name\": \"regcred\"\n              }\n            ],\n            \"volumes\": list(system.variables.volumes_list)\n          }\n        },\n        \"pair\": False,\n        \"replicas\": 4\n      }\n    }\n  }\n}\n"
            }
        ],
        "variables": [
            {
                "access_mode": "PEER_WRITABLE",
                "name": "image",
                "typed_value": "artifact.bytedance.com/fedlearner/fedlearner:50a6945",
                "value": "artifact.bytedance.com/fedlearner/fedlearner:50a6945",
                "value_type": "STRING",
                "widget_schema": "{\"component\":\"Input\",\"required\":true}"
            }
        ]
    },
    "editor_info": {
        "yaml_editor_infos": {
            "raw-data-job": {
                "meta_yaml": "{\n  \"apiVersion\": \"fedlearner.k8s.io/v1alpha1\",\n  \"kind\": \"FLApp\",\n  \"metadata\": {\n    \"name\": self.name,\n    \"namespace\": system.variables.namespace,\n    \"annotations\":{\n        \"queue\": \"fedlearner\",\n        \"schedulerName\": \"batch\"\n    },\n    \"labels\": ${Slot_labels}\n  },\n  \"spec\": {\n    \"role\": \"Follower\",\n    \"peerSpecs\": {\n      \"Leader\": {\n        \"peerURL\": \"\",\n        \"authority\": \"\"\n      }\n    },\n    \"flReplicaSpecs\": {\n      \"Master\": {\n        \"template\": {\n          \"spec\": {\n            \"restartPolicy\": \"Never\",\n            \"containers\": [\n              {\n                \"env\": system.basic_envs_list + [\n                  {\n                    \"name\": \"STORAGE_ROOT_PATH\",\n                    \"value\": ${Slot_storage_root_path}\n                  },\n                    {\n                    \"name\": \"EGRESS_URL\",\n                    \"value\": \"fedlearner-stack-ingress-nginx-controller.default.svc:80\"\n                  },\n                  {\n                    \"name\": \"EGRESS_HOST\",\n                    \"value\": project.participants[0].egress_host\n                  },\n                  {\n                    \"name\": \"EGRESS_DOMAIN\",\n                    \"value\": project.participants[0].egress_domain\n                  },\n                  {\n                    \"name\": \"APPLICATION_ID\",\n                    \"value\": self.name\n                  },\n                  {\n                    \"name\": \"DATA_PORTAL_NAME\",\n                    \"value\": self.name\n                  },\n                    {\n                    \"name\": \"DATA_PORTAL_TYPE\",\n                    \"value\": ${Slot_data_portal_type}\n                  },\n                  {\n                    \"name\": \"OUTPUT_PARTITION_NUM\",\n                    \"value\": str(${Slot_output_partition_num})\n                  },\n                  {\n                    \"name\": \"INPUT_BASE_DIR\",\n                    \"value\": ${Slot_input_base_dir}\n                  },\n                  {\n                    \"name\": \"OUTPUT_BASE_DIR\",\n                    \"value\": ${Slot_storage_root_path} + \"/raw_data/\" + self.name\n                  },\n                  {\n                    \"name\": \"RAW_DATA_PUBLISH_DIR\",\n                    \"value\": \"portal_publish_dir/\" + self.name\n                  },\n                  {\n                    \"name\": \"FILE_WILDCARD\",\n                    \"value\": ${Slot_file_wildcard}\n                  },\n                  {\n                    \"name\": \"LONG_RUNNING\",\n                    \"value\": ${Slot_long_running}\n                  },\n                  {\n                    \"name\": \"CHECK_SUCCESS_TAG\",\n                    \"value\": ${Slot_check_success_tag}\n                  },\n                  {\n                    \"name\": \"FILES_PER_JOB_LIMIT\",\n                    \"value\": str(${Slot_files_per_job_limit})\n                  },\n                  {\n                    \"name\": \"SINGLE_SUBFOLDER\",\n                    \"value\": ${Slot_single_subfolder}\n                  }\n\n                ] + ${Slot_master_envs},\n                \"imagePullPolicy\": \"IfNotPresent\",\n                \"name\": \"tensorflow\",\n                \"volumeMounts\": ${Slot_volume_mounts},\n                \"image\": ${Slot_image},\n                \"ports\": [\n                  {\n                    \"containerPort\": 50051,\n                    \"name\": \"flapp-port\",\n                    \"protocol\": \"TCP\"\n                  }\n                ],\n                \"command\": [\n                  \"/app/deploy/scripts/data_portal/run_data_portal_master.sh\"\n                ],\n                \"args\": [\n                ],\n                \"resources\": {\n                  \"limits\": {\n                    \"cpu\": ${Slot_master_cpu},\n                    \"memory\": ${Slot_master_memory}\n                  },\n                  \"requests\": {\n                    \"cpu\": ${Slot_master_cpu},\n                    \"memory\": ${Slot_master_memory}\n                  }\n                }\n              }\n            ],\n            \"imagePullSecrets\": [\n              {\n                \"name\": \"regcred\"\n              }\n            ],\n            \"volumes\": ${Slot_volumes}\n          }\n        },\n        \"pair\": False,\n        \"replicas\": 1\n      },\n      \"Worker\": {\n        \"template\": {\n          \"spec\": {\n            \"restartPolicy\": \"Never\",\n            \"containers\": [\n              {\n                \"env\": system.basic_envs_list + [\n                  {\n                    \"name\": \"STORAGE_ROOT_PATH\",\n                    \"value\": ${Slot_storage_root_path}\n                  },\n                  {\n                    \"name\": \"APPLICATION_ID\",\n                    \"value\": self.name\n                  },\n                  {\n                    \"name\": \"OUTPUT_BASE_DIR\",\n                    \"value\": ${Slot_storage_root_path} + \"/data_source/\" + self.name\n                  },\n                  {\n                    \"name\": \"EGRESS_URL\",\n                    \"value\": \"fedlearner-stack-ingress-nginx-controller.default.svc:80\"\n                  },\n                  {\n                    \"name\": \"EGRESS_HOST\",\n                    \"value\": project.participants[0].egress_host\n                  },\n                  {\n                    \"name\": \"EGRESS_DOMAIN\",\n                    \"value\": project.participants[0].egress_domain\n                  },\n\n                  {\n                    \"name\": \"BATCH_SIZE\",\n                    \"value\": str(${Slot_batch_size})\n                  },\n                  {\n                    \"name\": \"INPUT_DATA_FORMAT\",\n                    \"value\": ${Slot_input_data_format}\n                  },\n                  {\n                    \"name\": \"COMPRESSED_TYPE\",\n                    \"value\": ${Slot_compressed_type}\n                  },\n                  {\n                    \"name\": \"OUTPUT_DATA_FORMAT\",\n                    \"value\": ${Slot_output_data_format}\n                  },\n                  {\n                    \"name\": \"BUILDER_COMPRESSED_TYPE\",\n                    \"value\": ${Slot_builder_compressed_type}\n                  },\n                  {\n                    \"name\": \"MEMORY_LIMIT_RATIO\",\n                    \"value\": str(${Slot_memory_limit_ratio})\n                  },\n                  {\n                    \"name\": \"OPTIONAL_FIELDS\",\n                    \"value\": ${Slot_optional_fields}\n                  }\n\n\n                ] + ${Slot_worker_envs},\n                \"imagePullPolicy\": \"IfNotPresent\",\n                \"name\": \"tensorflow\",\n                \"volumeMounts\": ${Slot_volume_mounts},\n                \"image\": ${Slot_image},\n                \"ports\": [\n                  {\n                    \"containerPort\": 50051,\n                    \"name\": \"flapp-port\",\n                    \"protocol\": \"TCP\"\n                  }\n                ],\n                \"command\": [\n                  \"/app/deploy/scripts/data_portal/run_data_portal_worker.sh\"\n                ],\n                \"args\": [\n                ],\n                \"resources\": {\n                  \"limits\": {\n                    \"cpu\": ${Slot_worker_cpu},\n                    \"memory\": ${Slot_worker_memory}\n                  },\n                  \"requests\": {\n                    \"cpu\": ${Slot_worker_cpu},\n                    \"memory\": ${Slot_worker_memory}\n                  }\n                }\n              }\n            ],\n            \"imagePullSecrets\": [\n              {\n                \"name\": \"regcred\"\n              }\n            ],\n            \"volumes\": ${Slot_volumes}\n          }\n        },\n        \"pair\": False,\n        \"replicas\": ${Slot_output_partition_num}\n      }\n    }\n  }\n}\n",
                "slots": {
                    "Slot_batch_size": {
                        "default": "",
                        "default_value": 1024.0,
                        "help": "原始数据是一批一批的从文件系统中读出来，batch_size为batch的大小",
                        "label": "Batch大小",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "INT"
                    },
                    "Slot_builder_compressed_type": {
                        "default": "",
                        "default_value": "",
                        "help": "choices=['', 'ZLIB', 'GZIP']  the format for output file",
                        "label": "输出压缩格式",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_check_success_tag": {
                        "default": "",
                        "default_value": "--check_success_tag",
                        "help": "choices:['','--check_success_tag'] means false and true, Check that a _SUCCESS file exists before processing files in a subfolder",
                        "label": "是否检查成功标志",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_compressed_type": {
                        "default": "",
                        "default_value": "",
                        "help": "choices=['', 'ZLIB', 'GZIP']  the compressed type of input data file",
                        "label": "压缩方式",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_data_portal_type": {
                        "default": "",
                        "default_value": "Streaming",
                        "help": "运行过一次后修改无效！！ the type of data portal type ,choices=['PSI', 'Streaming']",
                        "label": "数据入口类型",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_file_wildcard": {
                        "default": "",
                        "default_value": "*.rd",
                        "help": "文件名称的通配符， 将会读取input_base_dir下所以满足条件的文件，如\n1. *.csv，意为读取所有csv格式文件\n2. *.tfrecord，意为读取所有tfrecord格式文件\n3. xxx.txt，意为读取文件名为xxx.txt的文件",
                        "label": "文件名称的通配符",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_files_per_job_limit": {
                        "default": "",
                        "default_value": null,
                        "help": "空即不设限制，Max number of files in a job",
                        "label": "每个任务最多文件数",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "INT"
                    },
                    "Slot_image": {
                        "default": "",
                        "default_value": "artifact.bytedance.com/fedlearner/fedlearner:50a6945",
                        "help": "建议不修改，指定Pod中运行的容器镜像地址，修改此项可能导致本基本模版不适用",
                        "label": "容器镜像",
                        "reference": "workflow.variables.image",
                        "reference_type": "WORKFLOW",
                        "value_type": "STRING"
                    },
                    "Slot_input_base_dir": {
                        "default": "",
                        "default_value": "/app/deploy/integrated_test/tfrecord_raw_data",
                        "help": "必须修改，运行过一次后修改无效！！the base dir of input directory",
                        "label": "输入路径",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_input_data_format": {
                        "default": "",
                        "default_value": "TF_RECORD",
                        "help": "choices=['TF_RECORD', 'CSV_DICT']  the type for input data iterator",
                        "label": "输入数据格式",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_labels": {
                        "default": "",
                        "default_value": {},
                        "help": "建议不修改，格式： {}",
                        "label": "FLAPP额外元信息",
                        "reference": "system.variables.labels",
                        "reference_type": "SYSTEM",
                        "value_type": "OBJECT"
                    },
                    "Slot_long_running": {
                        "default": "",
                        "default_value": "",
                        "help": "choices: ['','--long_running']否，是。是否为常驻上传原始数据",
                        "label": "是否常驻",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_master_cpu": {
                        "default": "",
                        "default_value": "2000m",
                        "help": "Master Pod 所分配的CPU资源（request和limit一致）",
                        "label": "Master的CPU",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_master_envs": {
                        "default": "",
                        "default_value": [],
                        "help": "数组类型，master pod额外的环境变量",
                        "label": "Master额外环境变量",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "LIST"
                    },
                    "Slot_master_memory": {
                        "default": "",
                        "default_value": "3Gi",
                        "help": "Master Pod 所分配的内存资源（request和limit一致）",
                        "label": "Master的内存",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_memory_limit_ratio": {
                        "default": "",
                        "default_value": 70.0,
                        "help": "预测是否会OOM的时候用到，如果预测继续执行下去时占用内存会超过这个比例，就阻塞，直到尚未处理的任务处理完成。 注意这是个40-81之间的整数。",
                        "label": "内存限制比例",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "INT"
                    },
                    "Slot_optional_fields": {
                        "default": "",
                        "default_value": "",
                        "help": "optional stat fields used in joiner, separated by comma between fields, e.g. \"label,rit\"Each field will be stripped",
                        "label": "可选字段",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_output_data_format": {
                        "default": "",
                        "default_value": "TF_RECORD",
                        "help": "choices=['TF_RECORD', 'CSV_DICT']  the format for output file",
                        "label": "输出格式",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_output_partition_num": {
                        "default": "",
                        "default_value": 4.0,
                        "help": "运行过一次后修改无效！！输出数据的文件数量，对应Worker数量",
                        "label": "数据分区的数量",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "INT"
                    },
                    "Slot_single_subfolder": {
                        "default": "",
                        "default_value": "",
                        "help": "choices:['','--single_subfolder'] 否 是，Only process one subfolder at a time",
                        "label": "是否单一子文件夹",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_storage_root_path": {
                        "default": "",
                        "default_value": "/data",
                        "help": "联邦学习中任务存储根目录",
                        "label": "存储根目录",
                        "reference": "project.variables.storage_root_path",
                        "reference_type": "PROJECT",
                        "value_type": "STRING"
                    },
                    "Slot_volume_mounts": {
                        "default": "",
                        "default_value": [
                            {
                                "mountPath": "/data",
                                "name": "data"
                            }
                        ],
                        "help": "建议不修改，容器中卷挂载的位置，数组类型",
                        "label": "卷挂载位置",
                        "reference": "system.variables.volume_mounts_list",
                        "reference_type": "SYSTEM",
                        "value_type": "LIST"
                    },
                    "Slot_volumes": {
                        "default": "",
                        "default_value": [
                            {
                                "name": "data",
                                "persistentVolumeClaim": {
                                    "claimName": "pvc-fedlearner-default"
                                }
                            }
                        ],
                        "help": "建议不修改，数组类型，和volume_mounts一一对应",
                        "label": "为Pod提供的卷",
                        "reference": "system.variables.volumes_list",
                        "reference_type": "SYSTEM",
                        "value_type": "LIST"
                    },
                    "Slot_worker_cpu": {
                        "default": "",
                        "default_value": "2000m",
                        "help": "Worker Pod 所分配的CPU资源（request和limit一致）",
                        "label": "Worker的CPU",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    },
                    "Slot_worker_envs": {
                        "default": "",
                        "default_value": [],
                        "help": "数组类型，worker pod额外的环境变量",
                        "label": "Worker额外环境变量",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "LIST"
                    },
                    "Slot_worker_memory": {
                        "default": "",
                        "default_value": "3Gi",
                        "help": "Worker Pod 所分配的内存资源（request和limit一致）",
                        "label": "Worker的内存",
                        "reference": "",
                        "reference_type": "DEFAULT",
                        "value_type": "STRING"
                    }
                },
                "variables": []
            }
        }
    },
    "group_alias": "e2e-test",
    "name": "e2e-local"
}